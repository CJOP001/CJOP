{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_zegoUikitRn","_minimizing_helper","_interopRequireDefault","_logger","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_extends","assign","bind","target","i","arguments","length","source","apply","ZegoUIKitPrebuiltLiveStreamingFloatingMinimizedView","props","window","useWindowDimensions","width","height","borderRadius","left","top","showSoundWaveInAudioMode","isInit","setIsInit","useState","isVisable","setIsVisable","layout","setLayout","floatViewInfo","setFloatViewInfo","activeUserID","setActiveUserID","isMoving","setIsMoving","panResponder","PanResponder","create","onStartShouldSetPanResponder","evt","gestureState","onMoveShouldSetPanResponder","onPanResponderGrant","zloginfo","onPanResponderMove","Math","abs","dx","dy","newLeft","newTop","onPanResponderEnd","onPanResponderRelease","pressedHandle","callbackID","String","floor","random","layoutHandle","useCallback","e","x","y","nativeEvent","MinimizingHelper","getInstance","notifyMaximize","useEffect","onPrebuiltInit","onWindowMinimized","initConfig","getInitConfig","setIsMinimizeSwitch","onWindowMaximized","onEntryNormal","onActiveUserIDUpdate","createElement","Animated","View","style","position","display","onLayout","panHandlers","styles","floatAudioView","ZegoAudioVideoView","userID","showSoundWave","StyleSheet","overflow","zIndex","shadowColor","shadowOffset","shadowOpacity","shadowRadius","elevation"],"sources":["ZegoUIKitPrebuiltLiveStreamingFloatingMinimizedView.tsx"],"sourcesContent":["import React, { useEffect, useState, useCallback, useRef } from 'react';\nimport {\n    View,\n    Text,\n    Image,\n    Animated,\n    PanResponder,\n    StyleSheet,\n    useWindowDimensions,\n} from 'react-native';\nimport { ZegoAudioVideoView } from '@zegocloud/zego-uikit-rn';\nimport MinimizingHelper from \"../services/minimizing_helper\";\nimport { zloginfo } from \"../utils/logger\";\n  \nexport default function ZegoUIKitPrebuiltLiveStreamingFloatingMinimizedView(props: any) {\n    const window = useWindowDimensions();\n    const {\n        width = 90,\n        height = 160,\n        borderRadius = 10,\n        left = window.width / 2 || 100,\n        top = 10,\n        showSoundWaveInAudioMode = true,\n    } = props;\n    const [isInit, setIsInit] = useState(false);\n    const [isVisable, setIsVisable] = useState(false);\n    const [layout, setLayout] = useState({\n        left,\n        top,\n    });\n    const [floatViewInfo, setFloatViewInfo] = useState({\n        width: 0, height: 0,\n    });\n    const [activeUserID, setActiveUserID] = useState('');\n    const [isMoving, setIsMoving] = useState(false);\n\n    const panResponder = PanResponder.create({\n        onStartShouldSetPanResponder: (evt, gestureState) => true,\n        onMoveShouldSetPanResponder: (evt, gestureState) => true,\n        onPanResponderGrant: (evt, gestureState) => {\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderGrant gestureState', gestureState);\n            setIsMoving(false);\n        },\n        onPanResponderMove: (evt, gestureState) => {\n            // zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderMove layout', layout);\n            // zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderMove gestureState', gestureState);\n            if (\n                Math.abs(gestureState.dx) < 5 &&\n                Math.abs(gestureState.dy) < 5 &&\n                !isMoving\n            ) {\n                setIsMoving(false);\n            } else {\n                setIsMoving(true);\n                const newLeft = layout.left + gestureState.dx;\n                const newTop = layout.top + gestureState.dy;\n                if (newLeft >= (window.width - floatViewInfo.width) || newTop >= (window.height - floatViewInfo.height) || newLeft <= 0 || newTop <= 0) return;\n                setLayout({\n                    left: newLeft,\n                    top: newTop,\n                });\n            }\n        },\n        onPanResponderEnd: (evt, gestureState) => {\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderEnd layout', layout);\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderEnd gestureState', gestureState);\n        },\n        onPanResponderRelease: () => {\n            if (!isMoving) {\n                // Click\n                pressedHandle();\n            }\n            setIsMoving(false);\n        },\n    });\n\n    const callbackID = 'ZegoMinimizeRoom' + String(Math.floor(Math.random() * 10000));\n    \n    const layoutHandle = useCallback((e) => {\n        const  { x, y, width, height } = e.nativeEvent.layout;\n        zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] layoutHandle', x, y, width, height);\n        setFloatViewInfo({ width, height });\n    }, []);\n    const pressedHandle = async () => {\n        zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] pressedHandle');\n        MinimizingHelper.getInstance().notifyMaximize();\n    }\n\n    useEffect(() => {\n        MinimizingHelper.getInstance().onPrebuiltInit(callbackID, () => {\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] init success');\n            setIsInit(true);\n        });\n        return () => {\n            MinimizingHelper.getInstance().onPrebuiltInit(callbackID);\n        };\n    }, []);\n    useEffect(() => {\n        if (isInit) {\n            MinimizingHelper.getInstance().onWindowMinimized(callbackID, () => {\n                setIsVisable(true);\n                const initConfig = MinimizingHelper.getInstance().getInitConfig();\n                const { onWindowMinimized } = initConfig;\n\n                if (typeof onWindowMinimized === 'function') {\n                    onWindowMinimized();\n                    MinimizingHelper.getInstance().setIsMinimizeSwitch(true);\n                }\n            });\n            MinimizingHelper.getInstance().onWindowMaximized(callbackID, () => {\n                setIsVisable(false);\n                const initConfig = MinimizingHelper.getInstance().getInitConfig();\n                const { onWindowMaximized } = initConfig;\n\n                if (typeof onWindowMaximized === 'function') {\n                    onWindowMaximized();\n                    MinimizingHelper.getInstance().setIsMinimizeSwitch(true);\n                }\n            });\n            MinimizingHelper.getInstance().onEntryNormal(callbackID, () => {\n                setIsVisable(false);\n            });\n            MinimizingHelper.getInstance().onActiveUserIDUpdate(callbackID, (activeUserID) => {\n                // zloginfo(`[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onActiveUserIDUpdate`, activeUserID);\n                setActiveUserID(activeUserID);\n            });\n        }\n        return () => {\n            MinimizingHelper.getInstance().onWindowMinimized(callbackID);\n            MinimizingHelper.getInstance().onWindowMaximized(callbackID);\n            MinimizingHelper.getInstance().onEntryNormal(callbackID);\n            MinimizingHelper.getInstance().onActiveUserIDUpdate(callbackID);\n        }\n    }, [isInit]);\n    return (\n        <Animated.View\n            style={[\n                { position: 'absolute', left: layout.left, top: layout.top },\n                { display: isVisable ? 'flex' : 'none' },\n            ]}\n            onLayout={layoutHandle}\n            {...panResponder.panHandlers}\n        >\n            <View\n                style={[\n                    styles.floatAudioView,\n                    {\n                        width,\n                        height,\n                        borderRadius,\n                    }\n                ]}\n            >\n                {\n                    activeUserID ? <ZegoAudioVideoView\n                        key={activeUserID}\n                        userID={activeUserID}\n                        showSoundWave={showSoundWaveInAudioMode}\n                    /> : <View />\n                }\n            </View>\n        </Animated.View>\n    );\n}\n\nconst styles = StyleSheet.create({\n    floatAudioView: {\n        overflow: 'hidden',\n        zIndex: 10000,\n        shadowColor: \"#000\",\n        shadowOffset: {\n            width: 0,\n            height: 2,\n        },\n        shadowOpacity: 0.25,\n        shadowRadius: 3.84,\n        elevation: 8\n    },\n});"],"mappings":"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"}